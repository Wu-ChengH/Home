<div class="page_container" id="compInfluence">
  	<div class="left_map" id="left_map"></div>
  	<div class="right_table">
  		<div class="right_table_infotable1">
  			<div class="right_table_title right_table_title_topradius">
  				企业影响图谱
  			</div>
  			<div class="right_table1_pie" id="right_table1_pie">
  				
  			</div>
  			<div class="right_table_title">
  				注册资本分布情况
  			</div>
  			<div class="right_table1_line">
  				<div id="right_table1_line">
  					
  				</div>
  			</div>
  		</div>
  		<div class="right_table_infotable2">
  			<div class="right_table_title">
  				影响到的企业列表
  			</div>
  			<table class="cdaicTable"  border="0" cellpadding="0" cellspacing="0" width="100%" align="left">
				<tr>
					<td>
						<div class="compTable-title">企业名称</div>
					</td>
				</tr>
				<tr>
					<td align="left">
						<div class="compTable-des">成都万达传媒有限公司</div>
					</td>
				</tr>
				<tr>
					<td align="left">
						<div class="compTable-des compTable-des-double">成都万达金沙店</div>
					</td>
				</tr>
				<tr>
					<td align="left">
						<div class="compTable-des">成都万达金沙店</div>
					</td>
				</tr>
				<tr>
					<td align="left">
						<div class="compTable-des compTable-des-double">成都万达金沙店</div>
					</td>
				</tr>
				<tr>
					<td align="left">
						<div class="compTable-des">成都万达金沙店</div>
					</td>
				</tr>
				<tr>
					<td align="left">
						<div class="compTable-des compTable-des-double">成都万达金沙店</div>
					</td>
				</tr>
				<tr>
					<td align="left">
						<div class="compTable-des">成都万达金沙店</div>
					</td>
				</tr>
				<tr>
					<td align="left">
						<div class="compTable-des compTable-des-double">成都万达金沙店</div>
					</td>
				</tr>
			</table>
  		</div>
  	</div>
</div>

<script rel="script">
  define(function(require){
    require("src/webapps/compInfluence/compInfluence.css");
    require("lib/echarts3/map/js/china.js");
    require("lib/echarts3/map/chengdu/chengdu.js");
    var base = require("Base");
    return base.extend({

      info : {
        position : ['企业多维画像', '企业影响力分析'], //页面位置
        history  : null //当前页面返回的目标页面，非必须。传入对应页面的模块名即可。'user'
      },

      onInit : function(option){

        var _this = this;
        
        _this.creatMapChart();
        _this.creatPieChart();
        _this.creatLineChart();
        
        $(".right_table_infotable2").loadScroll();
        //PageManager.pageInit();
      },
      
      creatLineChart : function(){
    	var self =this;
    	var option = {
    		    xAxis: {
    		        type: 'value'
    		    },
    		    yAxis: {
    		        type: 'category',
    		        data: ['100','500','1000','2000','5000']
    		    },
    		    dataZoom: [
    		        {
    		            type: 'inside'
    		        }
    		    ],
    		    series: [
    		        { // For shadow
    		            type: 'bar',
    		            itemStyle: {
    		                normal: {color: 'rgba(0,0,0,0.05)'}
    		            },
    		            barGap:'-100%',
    		            barCategoryGap:'50%',
    		            data: [20000, 20000, 20000, 20000, 20000]
    		        },
    		        {
    		            type: 'bar',
    		            itemStyle: {
    		                normal: {
    		                    color: '#9bcd65'
    		                }
    		            },
    		            data: [17220, 13811, 12191, 6500, 2000]
    		        }
    		    ]
    		};
    	var myChart = echarts.init(document.getElementById('right_table1_line'));
		myChart.setOption(option);
      },
      
      creatPieChart:function(){
    	var self = this;  
    	
    	var option = {
   		    tooltip : {
   		        trigger: 'item',
   		        formatter: "{a} <br/>{b} : {c} ({d}%)"
   		    },
   		    calculable : true,
   		    series : [
   		        {
   		            name:'面积模式',
   		            type:'pie',
   		            radius : [10, 80],
   		           	label:{
   		           		normal:{
   		           			formatter: "{b}：{d}%"
   		           		}
   		           	},
   		            roseType : 'area',
   	   		 		labelLine:{
   	   		 			normal:{
   	   		 				length : 0.2,
   	   		 				length2: 0.1,
   	   		 				smooth:0.5
   	   		 			}
   	   		 		},
   	   		 		x: '50%',               // for funnel
   		            data:[
   		                {value:38.33, name:'计算机',itemStyle:{
   	   	   		 			normal:{
   	   	   		 				color:["#9ea9da"]
   	   	   		 			}
   	   	   		 		}},
   		                {value:25.00, name:'旅游业',itemStyle:{
   	   	   		 			normal:{
   	   	   		 				color:["#80ccc3"]
   	   	   		 			}
   	   	   		 		}},
   		                {value:8.33, name:'制造业',itemStyle:{
   	   	   		 			normal:{
   	   	   		 				color:["#f4521e"]
   	   	   		 			}
   	   	   		 		}},
   		                {value:11.67, name:'小微企业',itemStyle:{
   	   	   		 			normal:{
   	   	   		 				color:["#77919b"]
   	   	   		 			}
   	   	   		 		}},
   		                {value:16.67, name:'零售业',itemStyle:{
   	   	   		 			normal:{
   	   	   		 				color:["#ffd699"]
   	   	   		 			}
   	   	   		 		}}
   		            ]
   		        }
   		    ]
   		};
    	
    	var myChart = echarts.init(document.getElementById('right_table1_pie'));
		myChart.setOption(option);
      },
      
      creatMapChart : function(){
    	  var self = this;
   	  
   	  	  var geoCoordMap = {
   	  			"成都":[104.077657,30.660766],
   			    '大邑1': [103.468246,30.581207],
   			    '新津1': [103.815495,30.443813],
   			    '郫县1': [103.836192,30.906979],
   			    "都江堰":[103.585529,30.998153],
   			 	"邛崃":[103.37396,30.395978],
   			 	"蒲江":[103.505041,30.198407],
   			 	"双流":[104.132849,30.378034],
   	  			"龙泉驿":[104.236333,30.587177],
   	  			"彭州":[103.958074,30.958523],
   	  			"青白江":[104.270828,30.871278],
   	  			"金堂":[104.39271,30.875245],
   	 			"金堂2":[104.514592,30.728339]
   			};

   			var GZData = [
   			    [{name:'成都'},{name:'成都',value:100}],
   			    [{name:'成都'},{name:'大邑1',value:90}],
   			    [{name:'成都'},{name:'新津1',value:80}],
   			    [{name:'成都'},{name:'郫县1',value:30}],
   			 	[{name:'成都'},{name:'都江堰',value:60}],
   			 	[{name:'成都'},{name:'邛崃',value:40}],
   			 	[{name:'成都'},{name:'蒲江',value:80}],
   			 	[{name:'成都'},{name:'双流',value:98}],
   			 	[{name:'成都'},{name:'龙泉驿',value:85}],
   			 	[{name:'成都'},{name:'彭州',value:45}],
   			 	[{name:'成都'},{name:'青白江',value:55}],
   				[{name:'成都'},{name:'金堂',value:45}],
   				[{name:'成都'},{name:'金堂2',value:25}]
   			];

   			var planePath = 'path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z';

   			var convertData = function (data) {
   			    var res = [];
   			    for (var i = 0; i < data.length; i++) {
   			        var dataItem = data[i];
   			        var fromCoord = geoCoordMap[dataItem[0].name];
   			        var toCoord = geoCoordMap[dataItem[1].name];
   			        if (fromCoord && toCoord) {
   			            res.push({
   			                fromName: dataItem[0].name,
   			                toName: dataItem[1].name,
   			                coords: [fromCoord, toCoord]
   			            });
   			        }
   			    }
   			    return res;
   			};

   			var color = ['#a6c84c', '#ffa022', '#46bee9'];
   			var series = [];
   			[['企业影响力', GZData]].forEach(function (item, i) {
 				series.push({
   			        name: item[0],
   			        type: 'lines',
   			        zlevel: 1,
   			        effect: {
   			            show: false ,
   			            period: 6,
   			            trailLength: 0.7,
   			            color: '#fff',
   			            symbolSize: 3
   			        },
   			        lineStyle: {
   			            normal: {
   			                color: color[i],
   			                width: 2,
   			                curveness: 0.2
   			            }
   			        },
   			        data: convertData(item[1])
   			    },
   	   		    {
   	   		        name: item[0],
   	   		        type: 'lines',
   	   		        zlevel: 2,
   	   		        effect: {
   	   		            show: false,
   	   		            period: 6,
   	   		            trailLength: 0,
   	   		            symbol: planePath,
   	   		            symbolSize: 15
   	   		        },
   	   		        lineStyle: {
   	   		            normal: {
   	   		                color: color[i],
   	   		                width: 1,
   	   		                opacity: 0.4,
   	   		                curveness: 0.2
   	   		            }
   	   		        },
   	   		        data: convertData(item[1])
   	   		    },
   			    {
   			        name: item[0],
   			        type: 'effectScatter',
   			        coordinateSystem: 'geo',
   			        zlevel: 2,
   			        rippleEffect: {
   			            brushType: 'stroke'
   			        },
   			        label: {
   			            normal: {
   			                show: false,
   			                position: 'right',
   			                formatter: '{b}'
   			            }
   			        },
   			        symbolSize: function (val) {
   			            return val[2] / 5;
   			        },
   			        itemStyle: {
   			            normal: {
   			                //color: "#f90000"
   			          		color: color[i]
   			            }
   			        },
   			        data: item[1].map(function (dataItem) {
   			            return {
   			                name: dataItem[1].name,
   			                value: geoCoordMap[dataItem[1].name].concat([dataItem[1].value])
   			            };
   			        })
   			    });
   			});

   			var option = {
   			    backgroundColor: "transparent",
   			    title : {
   			        left: 'center',
   			        textStyle : {
   			            color: '#fff'
   			        }
   			    },
   			    tooltip : {
   			        trigger: 'item'
   			    },
   			    legend: {
   			        orient: 'vertical',
   			        top: 'bottom',
   			        left: 'right',
   			        data:['企业影响力'],
   			        textStyle: {
   			            color: '#fff'
   			        },
   			        selectedMode: 'single'
   			    },
   			    geo: {
   			        map: 'chengdu',
   			        label: {
   			            emphasis: {
   			                show: true
   			            },
   			            normal: {
		                    show: true
		                }
   			        },
   			     	scaleLimit:{
   			     		min:"1.2",
   			     		max:"1.2"
   			     	},
   			        roam: true
   			    },
   			    series: series
   			};
   			
   			var myChart = echarts.init(document.getElementById('left_map'));
   			myChart.setOption(option);
      }

      

    });
  });
</script>