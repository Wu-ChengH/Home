<div class="page_container" id="compBusinessAnalysis">
	<div id="individualCharts" class="fl"></div>
	<div class="layoutBox fr individualInfoBox">
		<div class="layoutBox-header">企业各纬度综合得分</div>
		<div class="layoutBox-content" id="comprehensiveRadar"></div>
		<div class="layoutBox-header">2015年营业额和纳税额变化趋势</div>
		<div class="layoutBox-content" id="changeLineChart"></div>
		<ul class="individualInfoList clearfix">
			<li>企业基本信息</li>
			<li>企业变更信息</li>
			<li>业绩信息</li>
			<li>动产抵押登记信息</li>
			<li>股权出资登记信息</li>
			<li>行政处罚信息</li>
			<li>预警信息</li>
			<li>企业公示信息</li>
			<li>企业迁移情况</li>
		</ul>
	</div>
</div>
<script rel="script">
    define(function(require){
		require("compBusinessAnalysis/compBusinessAnalysis.css");
        var base = require("Base");
        return base.extend({
			onInit : function(options){
				this.buildBtnsEvent();
				this.$("#individualCharts").height($(window).height()-120).width($(window).width()-430);
				this.individualCharts = echarts.init(document.getElementById('individualCharts'));
				this.comprehensiveRadar = echarts.init(document.getElementById('comprehensiveRadar'));
				this.changeLineChart = echarts.init(document.getElementById('changeLineChart'));
				this.buildIndividualCharts();
			},
			buildBtnsEvent : function(){
				
			},
			buildIndividualCharts : function(){
				var self = this;
				self.buildGraphChartsOption();
				
				var comprehensiveRadarData = [
					{
						value : [4300, 10000, 28000, 35000, 50000, 19000],
						name : '当前群体'
					},{
						value : [5000, 14000, 28000, 31000, 42000, 21000],
						name : '其他群体'
					}
				];
				self.comprehensiveRadar.setOption(self.buildRadarChartsOption(comprehensiveRadarData));
				
				self.changeLineChart.setOption(self.buildLineChartsOption());
			},
			
			//构建关系图
			buildGraphChartsOption : function(){
				var self = this;
				self.individualCharts.showLoading();
				$.get('src/webapps/individualPortrait/data/les-miserables.gexf', function (xml) {
					self.individualCharts.hideLoading();

					var graph = echarts.dataTool.gexf.parse(xml);
					var categories = [];
					for (var i = 0; i < 9; i++) {
						categories[i] = {
							name: '类目' + i
						};
					}
					graph.nodes.forEach(function (node) {
						node.itemStyle = null;
						node.value = node.symbolSize;
						node.symbolSize /= 1.5;
						node.label = {
							normal: {
								show: node.symbolSize > 30
							}
						};
						node.category = node.attributes.modularity_class;
					});
					var option = {
						backgroundColor:"transparent",
						animationDuration: 1500,
						animationEasingUpdate: 'quinticInOut',
						series : [
							{
								name: '成都四方伟业软件股份有限公司',
								type: 'graph',
								layout: 'none',
								data: graph.nodes,
								links: graph.links,
								categories: categories,
								roam: true,
								label: {
									normal: {
										position: 'right',
										formatter: '{b}'
									}
								},
								lineStyle: {
									normal: {
										color: 'source',
										curveness: 0.3
									}
								}
							}
						]
					};

					self.individualCharts.setOption(option);
				}, 'xml');
				
			},
			
			//构建雷达图配置项
			buildRadarChartsOption : function(chartData){
				var option = {
					legend: {
						//top:"bottom",
						icon:"circle",
						bottom:10,
						itemWidth:9,
						itemHeight:9,
						data: [chartData[0].name, chartData[1].name]
					},
					color:["#ff9600","#8c97cb"],
					radar: {
						shape: 'circle',
						center:["50%","45%"],
						indicator: [
						   { name: '竞争力', max: 6500},
						   { name: '人性化', max: 16000},
						   { name: '占有率', max: 30000},
						   { name: '社会形象', max: 38000},
						   { name: '影响力', max: 52000},
						   { name: '活力', max: 25000},
						   { name: '创新', max: 25000},
						   { name: '健康', max: 25000}
						],
						radius:80
					},
					series: [{
						name: '综合指标得分',
						type: 'radar',
						areaStyle : {
							normal : {
								//color : "#ff0000"
								opacity:0.3
							}	
						},
						data : chartData
					}]
				};
				return option;
			},
			
			//构建折线图配置项
			buildLineChartsOption : function(){
				var option = {
					tooltip : {
						trigger: 'axis'
					},
					legend: {
						data:['纳税额','营业额'],
						top:"bottom"
					},
					grid: {
						left: '3%',
						right: '4%',
						top: '10%',
						bottom:"10%",
						containLabel: true
					},
					xAxis : [
						{
							type : 'category',
							boundaryGap : false,
							data : ['1','2','3','4','5','6','7','8','9','10','11','12']
						}
					],
					yAxis : [
						{
							type : 'value'
						}
					],
					series : [
						{
							name:'纳税额',
							type:'line',
							stack: '总量',
							areaStyle: {normal: {}},
							data:[320, 332, 301, 334, 390, 330, 320, 301, 334, 390, 330, 320]
						},
						{
							name:'营业额',
							type:'line',
							stack: '总量',
							areaStyle: {normal: {}},
							data:[820, 932, 901, 934, 1290, 1330, 1320, 301, 334, 390, 330, 320]
						}
					]
				};
				return option;
			},
			
			goTargetPage : function(pageUrl){
				this.loadpage({
					$el : this.$("#content"),
					url : pageUrl
				})
			} 
			
		})
	})
</script>